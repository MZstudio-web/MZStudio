<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MZStudio – AI Content Generator</title>
  <style>
  body {
    font-family: "Poppins", sans-serif;
    background-image: url('https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=2000&q=80');
    background-size: cover;
    background-attachment: fixed;
    background-position: center;
    background-repeat: no-repeat;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
    position: relative;
  }

  /* Overlay for better contrast */
  body::before {
    content: "";
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0, 0, 0, 0.45);
    backdrop-filter: blur(5px);
    z-index: -1;
  }

  header {
    text-align: center;
    margin-top: 80px;
    animation: fadeIn 1s ease-in-out;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  h1 {
    font-size: 3rem;
    font-weight: 700;
    letter-spacing: 1px;
  }

  .mz {
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 10px rgba(255, 65, 108, 0.6);
    animation: glowMZ 2s ease-in-out infinite alternate;
  }

  .studio {
    background: linear-gradient(90deg, #0072ff, #00c6ff);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 10px rgba(0, 114, 255, 0.6);
    animation: glowStudio 2s ease-in-out infinite alternate;
  }

  @keyframes glowMZ {
    from { text-shadow: 0 0 8px rgba(255, 65, 108, 0.3); }
    to { text-shadow: 0 0 18px rgba(255, 65, 108, 0.8); }
  }

  @keyframes glowStudio {
    from { text-shadow: 0 0 8px rgba(0, 114, 255, 0.3); }
    to { text-shadow: 0 0 18px rgba(0, 114, 255, 0.8); }
  }

  .search-box {
    margin-top: 40px;
    display: flex;
    gap: 10px;
    width: 90%;
    max-width: 600px;
  }

  input[type="text"] {
    flex: 1;
    padding: 14px;
    border: none;
    border-radius: 30px;
    outline: none;
    font-size: 16px;
    backdrop-filter: blur(6px);
    background: rgba(255, 255, 255, 0.2);
    color: #fff;
    transition: all 0.3s;
  }

  input::placeholder {
    color: rgba(255, 255, 255, 0.7);
  }

  input:focus {
    background: rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 10px rgba(0, 114, 255, 0.5);
  }

  button {
    background: linear-gradient(90deg, #007bff, #00c6ff);
    color: white;
    border: none;
    border-radius: 30px;
    padding: 14px 24px;
    cursor: pointer;
    font-size: 16px;
    transition: transform 0.2s, box-shadow 0.3s;
  }

  button:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,123,255,0.6);
  }

  .results {
    margin-top: 50px;
    width: 90%;
    max-width: 900px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
  }

  .card {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    padding: 20px;
    backdrop-filter: blur(10px);
    color: #fff;
    transition: transform 0.3s, box-shadow 0.3s;
  }

  .card:hover {
    transform: translateY(-6px);
    box-shadow: 0 6px 25px rgba(0,0,0,0.4);
  }
</style>
<body>
  <header>
    <h1><span class="mz">MZ</span><span class="studio">Studio</span></h1>
   
    <div class="search-box">
      <input id="topicInput" type="text" placeholder="Enter a topic...">
      <button onclick="generatePost()">Search</button>
    </div>
    </div>
  </header>

  <div class="results" id="results"></div>

  <script>
  async function generatePost() {
    const topic = document.getElementById("topicInput").value.trim();
    if (!topic) {
      alert("Please enter a topic!");
      return;
    }

    // 1) Open a new tab immediately on the click (avoids popup blocker)
    const newTab = window.open("", "_blank");
    if (!newTab) {
      alert("Browser blocked opening a new tab. Allow popups for this site and try again.");
      return;
    }

    // 2) Show a loading page while we wait for the backend
    newTab.document.write(`
      <html>
      <head>
        <title>Generating: ${topic} — MZStudio</title>
        <style>
          body { font-family: 'Poppins', sans-serif; display:flex; align-items:center; justify-content:center;
                 height:100vh; margin:0; background:linear-gradient(135deg,#f0f6ff,#eef9f1); color:#222; }
          .box { text-align:center; background:#fff; padding:28px; border-radius:12px; box-shadow:0 8px 30px rgba(0,0,0,0.08); }
          .dot { height:10px; width:10px; margin:0 6px; display:inline-block; border-radius:50%; background:#007bff; animation:blink 1s infinite; }
          @keyframes blink { 0%{opacity:0.2} 50%{opacity:1} 100%{opacity:0.2} }
        </style>
      </head>
      <body>
        <div class="box">
          <h2>Generating content for: <em>${topic}</em></h2>
          <p>Please wait — Jarves is crafting something creative... </p>
          <div><span class="dot"></span><span class="dot" style="animation-delay:0.2s"></span><span class="dot" style="animation-delay:0.4s"></span></div>
        </div>
      </body>
      </html>
    `);
    newTab.document.close();

    // 3) Call backend
    try {
      const res = await fetch("/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ topic })
      });

      const data = await res.json();

      if (data.error) {
        newTab.document.body.innerHTML = `<div style="font-family:Poppins, sans-serif; padding:40px;"><h2>Error</h2><p>${data.error}</p></div>`;
        return;
      }

      // 4) Build nice HTML for the returned post text
      // If AI returns a structured text (Options), we preserve formatting.
      const safePost = (data.post || "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replace(/\n/g, "<br>");

      const fullHtml = `
        <html>
        <head>
          <title>${topic} – MZStudio</title>
          <meta name="viewport" content="width=device-width,initial-scale=1">
          <style>
            body { font-family:'Poppins',sans-serif; background:#f7f9fc; color:#111; margin:24px; line-height:1.6; }
            .container { max-width:900px; margin:0 auto; }
            header { text-align:center; margin-bottom:18px; }
            h1 { margin:0; color:#0b63d6; }
            .post { background:#fff; border-radius:12px; padding:22px; box-shadow:0 8px 30px rgba(11,99,214,0.08); margin-top:18px; }
            .option { margin-bottom:18px; padding-bottom:12px; border-bottom:1px dashed #eee; }
            .option h3 { margin:8px 0; color:#ff416c; }
            pre { white-space:pre-wrap; font-family:inherit; }
            @media (max-width:600px){ body{margin:12px;} .post{padding:16px;} }
          </style>
        </head>
        <body>
          <div class="container">
            <header><h1>${topic} — Generated Posts</h1></header>
            <div class="post">
              <pre>${safePost}</pre>
            </div>
          </div>
        </body>
        </html>
      `;

      // 5) Replace tab content with generated content
      newTab.document.open();
      newTab.document.write(fullHtml);
      newTab.document.close();

    } catch (err) {
      // network/backend error
      newTab.document.body.innerHTML = `<div style="font-family:Poppins, sans-serif; padding:40px;"><h2>Something went wrong</h2><pre>${err.message}</pre><p>Check the browser console and the server logs.</p></div>`;
      console.error("Generate error:", err);
    }
  }
</script>


</body>
</html>

